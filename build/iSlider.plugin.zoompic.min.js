!function(t){function e(t,e,a,s){return"translate"+(X?"3d(":"(")+t+"px,"+e+(X?"px,"+a+"px)":"px)")+"scale("+s+")"}function a(t,e){var a,s;return a=t.left-e.left,s=t.top-e.top,Math.sqrt(a*a+s*s)}function s(t,e){return t+"px "+e+"px"}function r(t){return Array.prototype.slice.call(t).map(function(t){return{left:t.pageX,top:t.pageY}})}function o(t,e){var s=a(t[0],t[1]),r=a(e[0],e[1]);return r/s}function n(t){var e={translateX:0,translateY:0,translateZ:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0},a=0,s=0;if(!window.getComputedStyle||!t)return e;var r,o,n=window.getComputedStyle(t);r=n.webkitTransform||n.mozTransform,o=n.webkitTransformOrigin||n.mozTransformOrigin;var i=o.match(/(.*)px\s+(.*)px/);if(i.length>1&&(a=i[1]-0,s=i[2]-0),"none"==r)return e;var l=r.match(/^matrix3d\((.+)\)$/),c=r.match(/^matrix\((.+)\)$/);if(l){var f=l[1].split(", ");e={translateX:f[12]-0,translateY:f[13]-0,translateZ:f[14]-0,offsetX:a-0,offsetY:s-0,scaleX:f[0]-0,scaleY:f[5]-0,scaleZ:f[10]-0}}else if(c){var f=c[1].split(", ");e={translateX:f[4]-0,translateY:f[5]-0,offsetX:a-0,offsetY:s-0,scaleX:f[0]-0,scaleY:f[3]-0}}return e}function i(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}function l(t){this.currentScale=1,this.zoomFactor=t.zoomFactor||2}function c(t){if(this.useZoom){var e=this.els[1].querySelector("img"),a=n(e);this.startTouches=r(t.targetTouches),this._startX=a.translateX-0,this._startY=a.translateY-0,this.currentScale=a.scaleX,this.zoomNode=e;var o=m(e);if(2==t.targetTouches.length){console.log("gesture"),this.lastTouchStart=null;var l=t.touches,c=i({x:l[0].pageX,y:l[0].pageY},{x:l[1].pageX,y:l[1].pageY});e.style.webkitTransformOrigin=s(c.x-o.left,c.y-o.top)}else if(1===t.targetTouches.length){var f=(new Date).getTime();this.gesture=0,f-this.lastTouchStart<300&&(t.preventDefault(),this.gesture=3),this.lastTouchStart=f}}}function f(t){var e=0,a=this.zoomNode,s=this._device();return s.hasTouch?(2===t.targetTouches.length&&this.useZoom?(a.style.webkitTransitionDuration="0",t.preventDefault(),this._scaleImage(t),e=2):1==t.targetTouches.length&&this.useZoom&&this.currentScale>1&&(a.style.webkitTransitionDuration="0",t.preventDefault(),this._moveImage(t),e=1),this.gesture=e,e):void 0}function h(t){var a=this.zoomFactor||2,r=this.zoomNode,o=m(r);this.currentScale=1==this.currentScale?a:1,r.style.webkitTransform=e(0,0,0,this.currentScale),1!=this.currentScale&&(r.style.webkitTransformOrigin=s(t.touches[0].pageX-o.left,t.touches[0].pageY-o.top))}function u(t){var a=r(t.targetTouches),s=o(this.startTouches,a);t.scale=t.scale||s;var n=this.zoomNode;s=this.currentScale*t.scale<Y?Y:this.currentScale*t.scale,n.style.webkitTransform=e(0,0,0,s)}function p(t){var e=0;return 2===this.gesture?(this._resetImage(t),e=2):1==this.gesture?(this._resetImage(t),e=1):3===this.gesture&&(this._handleDoubleTap(t),this._resetImage(t)),e}function g(t){var a=this.zoomNode,s=this._device(),r={X:s.hasTouch?t.targetTouches[0].pageX-this.startX:t.pageX-this.startX,Y:s.hasTouch?t.targetTouches[0].pageY-this.startY:t.pageY-this.startY};this.moveOffset={x:this._startX+r.X-0,y:this._startY+r.Y-0},a.style.webkitTransform=e(this.moveOffset.x,this.moveOffset.y,0,this.currentScale)}function m(t){var e={left:0,top:0};do e.top+=t.offsetTop||0,e.left+=t.offsetLeft||0,t=t.offsetParent;while(t);return e}function d(t,e,a){var s,r,o=m(t);b={start:{left:o.left,top:o.top},end:{left:o.left+t.clientWidth,top:o.top+t.clientHeight}};var n=1==a?"left":"top";return s=b.start[n],r=b.end[n],e>=s&&r>=e}function v(t,e){var a=0,s=d(t,e.start.left,1),r=d(t,e.end.left,1),o=d(t,e.start.top,0),n=d(t,e.end.top,0);return s!=r&&o!=n?a=s&&n?1:s&&o?2:r&&n?3:4:s==r?!o&&n?a=5:!n&&o&&(a=6):o==n?!s&&r?a=7:s&&!r&&(a=8):o==n==s==r&&(a=9),a}function T(){if(1!=this.currentScale){var t,a,s,r,o,i,l,c,f,h,u=this.zoomNode;switch(s=n(u),f=u.parentNode,r=u.clientWidth*s.scaleX,o=u.clientHeight*s.scaleX,i=m(u),l={left:(1-s.scaleX)*s.offsetX+i.left+s.translateX,top:(1-s.scaleX)*s.offsetY+i.top+s.translateY},c={left:l.left+r,top:l.top+o},t=l.left,a=l.top,h=v(f,{start:l,end:c})){case 1:t=b.start.left,a=b.end.top-o;break;case 2:t=b.start.left,a=b.start.top;break;case 3:t=b.end.left-r,a=b.end.top-o;break;case 4:t=b.end.left-r,a=b.start.top;break;case 5:a=b.end.top-o;break;case 6:a=b.start.top;break;case 7:t=b.end.left-r;break;case 8:t=b.start.left}r<f.clientWidth&&(t=i.left-(s.scaleX-1)*u.clientWidth/2),o<f.clientHeight&&(a=i.top-(s.scaleX-1)*u.clientHeight/2),u.style.webkitTransitionDuration="100ms",u.style.webkitTransform=e(s.translateX+t-l.left,s.translateY+a-l.top,0,s.scaleX)}}var X="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,Y=.5,b={};t.iSlider.extend({_initZoom:l,_scaleImage:u,_moveImage:g,_resetImage:T,_handleDoubleTap:h,_moveHandler:f,_endHandler:p,_startHandler:c})}(this);